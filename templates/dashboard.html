<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Insights Pro - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .stat-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .stat-change {
            color: #28a745;
            font-weight: 500;
        }
        
        .charts-container {
            padding: 0 30px 30px;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-box {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .chart-box h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .chart-canvas {
            width: 100%;
            height: 300px;
        }
        
        .insights-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 0 30px 30px;
        }
        
        .insights-section h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .insight-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }
        
        .real-time-updates {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 0 30px 30px;
        }
        
        .update-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>üìä Telegram Insights Pro</h1>
            <p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∞—à–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üì® –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                <div class="stat-value" id="totalMessages">0</div>
                <div class="stat-change" id="messagesChange">+0%</div>
            </div>
            
            <div class="stat-card">
                <h3>üë• –ê–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤</h3>
                <div class="stat-value" id="activeChats">0</div>
                <div class="stat-change" id="chatsChange">+0%</div>
            </div>
            
            <div class="stat-card">
                <h3>üìä –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞</h3>
                <div class="stat-value" id="avgLength">0</div>
                <div class="stat-change" id="lengthChange">+0%</div>
            </div>
            
            <div class="stat-card">
                <h3>üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è</h3>
                <div class="stat-value" id="todayActivity">0</div>
                <div class="stat-change" id="activityChange">+0%</div>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart-grid">
                <div class="chart-box">
                    <h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º</h3>
                    <canvas class="chart-canvas" id="activityChart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–Ω—è–º</h3>
                    <canvas class="chart-canvas" id="weekdayChart"></canvas>
                </div>
            </div>
            
            <div class="chart-grid">
                <div class="chart-box">
                    <h3>–¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                    <canvas class="chart-canvas" id="typeChart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                    <canvas class="chart-canvas" id="trendChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="insights-section">
            <h2>üí° –ò–Ω—Å–∞–π—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
            <div id="insightsList">
                <div class="insight-item">
                    <strong>–ü–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</strong> –í–∞—à–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º–∞ –≤ 19:00
                </div>
                <div class="insight-item">
                    <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –Ω–∞ –≤—Ä–µ–º—è –ø–∏–∫–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                </div>
                <div class="insight-item">
                    <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong> –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 45 —Å–∏–º–≤–æ–ª–æ–≤
                </div>
            </div>
        </div>
        
        <div class="real-time-updates">
            <h3>üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h3>
            <div id="updatesContainer">
                <div class="update-item">
                    <span id="lastUpdate">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocket
        const ws = new WebSocket(`ws://${window.location.host}/ws/updates`);
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            document.getElementById('lastUpdate').innerHTML = 
                `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(data.timestamp).toLocaleTimeString()} | ` +
                `–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.active_users} | ` +
                `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${data.messages_processed}`;
        };
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/reports');
                const reports = await response.json();
                
                if (reports.length > 0) {
                    const latestReport = reports[reports.length - 1];
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    document.getElementById('totalMessages').textContent = 
                        latestReport.stats.total_messages || 0;
                    document.getElementById('avgLength').textContent = 
                        Math.round(latestReport.stats.avg_message_length || 0);
                    document.getElementById('todayActivity').textContent = 
                        latestReport.stats.daily_avg ? Math.round(latestReport.stats.daily_avg) : 0;
                    document.getElementById('activeChats').textContent = 
                        reports.length;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
                    updateCharts(reports);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        const activityCtx = document.getElementById('activityChart').getContext('2d');
        const activityChart = new Chart(activityCtx, {
            type: 'bar',
            data: {
                labels: Array.from({length: 24}, (_, i) => i + ':00'),
                datasets: [{
                    label: '–°–æ–æ–±—â–µ–Ω–∏–π',
                    data: Array(24).fill(0),
                    backgroundColor: 'rgba(102, 126, 234, 0.7)',
                    borderColor: 'rgba(102, 126, 234, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '–í—Ä–µ–º—è —Å—É—Ç–æ–∫'
                        }
                    }
                }
            }
        });
        
        const weekdayCtx = document.getElementById('weekdayChart').getContext('2d');
        const weekdayChart = new Chart(weekdayCtx, {
            type: 'pie',
            data: {
                labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
                datasets: [{
                    data: [0, 0, 0, 0, 0, 0, 0],
                    backgroundColor: [
                        '#667eea', '#764ba2', '#f56565', '#ed8936',
                        '#ecc94b', '#48bb78', '#38b2ac'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
        
        function updateCharts(reports) {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
            // –ü–æ–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const activityData = Array.from({length: 24}, (_, i) => 
                Math.floor(Math.random() * 100) + 20
            );
            activityChart.data.datasets[0].data = activityData;
            activityChart.update();
            
            const weekdayData = Array.from({length: 7}, () => 
                Math.floor(Math.random() * 50) + 10
            );
            weekdayChart.data.datasets[0].data = weekdayData;
            weekdayChart.update();
        }
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        loadDashboardData();
        setInterval(loadDashboardData, 30000);
    </script>
</body>
</html>
